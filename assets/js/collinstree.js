var treeData =
  {"name": "Sylvia Haney",
   "fullname": "Sylvia Mae Landgren Haney",
    "birth": "1936",
    "location": "Rockford, Illinois",
    "link": "/collins/about",
   "children": [
    {"name": "Erick Landgren",
     "fullname": "Erick Landgren",
     "birth": "1914",
     "location": "Rockford, Illinois",
     "link": "/collins/about",
    },
    {"name": "Roberta Collins",
     "fullname": "Roberta Collins",
     "birth": "1917",
     "location": "Rockford, Illinois",
     "link": "/collins/about",
     "children": [
       {"name": "Robert Collins",
        "fullname": "Robert Collins",
        "birth": "1886",
        "location": "Edgerton, Rock, Wisconsin",
	"link": "/collins/person/robert-collins",
        "children": [
          {"name": "Frank Collins",
     	   "fullname": "Isaac Franklin Collins",
           "birth": "1859",
           "location": "Fulton, Rock, Wisconsin",
	   "link": "/collins/person/frank-collins",
           "children": [
            {"name": "Milo Collins",
             "fullname": "Milo Collins",
             "birth": "1836",
             "location": "New York",
	     "link": "/collins/person/milo-collins"},
            {"name": "Rebecca Green",
	     "fullname": "Rebecca Green",
             "birth": "1842",
             "location": "Allegany County, New York",
	     "link": "/collins/person/rebecca-green",
             "children": [
              {"name": "Edward Green",
	       "fullname": "Edward Green",
               "birth": "1798",
               "location": "Jefferson County, New York",
	       "link": "/collins/person/edward-green",
               "children":[
                {"name": "Edward Greene",
	     	 "fullname": "Judge Edward Greene",
                 "birth": "1760",
                 "location": "Westerly, Kings County, Rhode Island",
		 "link": "/collins/person/judge-edward-greene",
                 "children":[
                  {"name": "Joseph Greene",
	     	   "fullname": "Joseph Greene",
                   "birth": "1725",
                   "location": "East Greenwich, Rhode Island",
		   "link": "/collins/person/joseph-greene",
                   "children":[
                    {"name":"John Greene",
	     	     "fullname":"John 'White Hat' Greene",
                     "birth": "1688",
                     "location": "Quidnesset, North Kingstown, Rhode Island",
		     "link": "/collins/person/john-whitehat-greene",
                     "children":[
                      {"name":"Benjamin Greene",
	     	       "fullname":"Benjamin Greene",
                       "birth": "1665",
                       "location": "Quidnesset, North Kingstown, Rhode Island",
		       "link": "/collins/person/benjamin-greene",
                       "children":[
                        {"name":"John Greene",
	     		 "fullname":"John Greene",
                         "birth": "N/A",
                         "location": "N/A",
			 "link": "/collins/about"},
                         {"name":"Joan",
			  "fullname":"Joan",
                          "birth": "N/A",
                          "location": "N/A",
			  "link": "/collins/about"}
                      ]},
                       {"name": "Humility Coggeshall",
			"fullname": "Humility Coggeshall",
                        "birth": "1671",
                        "location": "Portsmouth, Rhode Island",
			"link": "/collins/person/humility-coggeshall",
                        "children": [
                          {"name": "Joshua Coggeshall",
			   "fullname": "Joshua Coggeshall",
                           "birth": "N/A",
                           "location": "N/A",
			   "link": "/collins/about"},
                          {"name": "Joan West",
			   "fullname": "Joan West",
                           "birth": "N/A",
                           "location": "N/A",
			   "link": "/collins/about"}
                        ]}
                    ]},
                    {"name":"Mary Alsworth",
		     "fullname":"Mary Alsworth",
                     "birth": "1688",
                     "location": "Quidnesset, North Kingstown, Rhode Island",
		     "link": "/collins/about",
                     "children": [
                       {"name": "Arthur Alsworth",
			"fullname": "Arthur Alsworth",
                        "birth": "N/A",
                        "location": "England or Wales",
		        "link": "/collins/about"},
                       {"name": "Mary Brown",
			"fullname": "Mary Brown",
                        "birth": "N/A",
                        "location": "Providence, Rhode Island",
			"link": "/collins/about",
                        "children": [
                          {"name": "Rev. John Brown",
			   "fullname": "Reverend John Brown",
                           "birth": "N/A",
                           "location": "Rhode Island",
			   "link": "/collins/about"},
                          {"name": "Mary Holmes",
			   "fullname": "Mary Holmes",
                           "birth": "N/A",
                           "location": "Rhode Island",
			   "link": "/collins/about",
                           "children": [
                             {"name": "Obediah Holmes",
			      "fullname": "Reverend Obediah Holmes",
                              "birth": "N/A",
                              "location": "Rhode Island",
			      "link": "/collins/about"}
                           ]}
                        ]}
                     ]}
                  ]},
                  {"name": "Margaret Greenman",
		   "fullname": "Margaret Greenman",
                   "birth": "1725",
                   "location": "Charlestown, Rhode Island",
		   "link": "/collins/person/margaret-greenman",
                   "children": [
                     {"name": "Edward Greenman",
		      "fullname": "Edward Greenman",
                      "birth": "N/A",
                      "location": "N/A",
		      "link": "/collins/person/edward-greenman"},
                     {"name": "Sarah Clarke",
		      "fullname": "Sarah Clarke",
                      "birth": "N/A",
                      "location": "N/A",
		      "link": "/collins/person/edward-greenman"}
                   ]}
                ]},
                {"name": "Huldah Sweet",
		 "fullname": "Huldah Sweet",
                 "birth": "1758",
                 "location": "Alfrded, Allegany Co., New York",
		 "link": "/collins/about"}
              ]},
              {"name": "Sarah Peckham",
	       "fullname": "Sarah Peckham",
               "birth": "1797",
               "location": "Petersburg, Rensselaer Co., New York",
	       "link": "/collins/person/sarah-peckham",
               "children": [
                 {"name": "Braddock Peckham",
		  "fullname": "Braddock Peckham",
                  "birth": "N/A",
                  "location": "N/A",
		  "link": "/collins/about"},
                 {"name": "Rebecca Peckham",
		  "fullname": "Rebecca Peckham",
                  "birth": "N/A",
                  "location": "N/A",
		  "link": "/collins/about"}
               ]}
            ]}
          ]},
          { "name": "Paulina Juhnke",
	    "fullname": "Paulina Juhnke",
            "birth": "1860",
            "location": "Newton, Marquette, Wisconsin",
	    "link": "/collins/person/paulina-juhnke",
            "children": [
              {"name": "Gottfried Juhnke",
	       "fullname": "Gottfried August Juhnke",
               "birth": "1821",
               "location": "Poland",
	       "link": "/collins/person/gottfried-juhnke"},
              {"name": "Dora Dr채ger",
	       "fullname": "Dorothea Magdalena Dr채ger",
               "birth": "1823",
               "location": "Friedrichswalde Parish, Pommern (Pomerania)",
	       "link": "/collins/person/dorothea-draeger",
                "children": [
                    {"name": "Johann Dr채ger",
		     "fullname": "Johann Christian Dr채ger",
                     "birth": "N/A",
                     "location": "N/A",
		     "link": "/collins/person/dorothea-draeger"},
                    {"name": "Hanna Verges",
		     "fullname": "Hanna Charlotta Verges",
                     "birth": "N/A",
                     "location": "N/A",
		     "link": "/collins/person/dorothea-draeger"}
                  ]}
            ]}
          ]},
       {"name": "May Allen",
	"fullname": "May Allen",
        "birth": "1888",
        "location":  "Rockford Ward 7, Winnebago, Illinois",
	"link": "/collins/person/may-allen",
        "children": [
        {"name": "William Allen",
	 "fullname": "William Allen",
         "birth": "1850",
         "location": "New York or Pennsylvania",
	 "link": "/collins/person/william-allen"},
        {"name": "Sarah Sheffield",
	 "fullname": "Sarah Sheffield",
         "birth": "1850",
         "location": "New York",
	 "link": "/collins/person/sarah-sheffield",
         "children": [
          {"name": "Daniel Sheffield",
	   "fullname": "Daniel M. Sheffield",
           "birth": "1831",
           "location": "New York",
	   "link": "/collins/person/mary-blakely"},
          {"name": "Mary Blakely",
	   "fullname": "Mary Ann Blakely",
           "birth": "1840",
           "location": "New York",
	   "link": "/collins/person/mary-blakely",
	   "children": [
	    {"name": "Elizabeth Blakely",
	     "fullname": "Elizabeth Blakely",
	     "birth": "1800",
	     "location": "New York",
	     "link": "/collins/person/mary-blakely"},
	    {"name": "Francis Blakely",
	     "fullname": "Francis Blakely",
	     "birth": "1779",
	     "location": "Massachusets",
	     "link": "/collins/person/mary-blakely"}
	   ]
	  }
        ]}
      ]}
    ]
  }
 ]};

//************************ CREATE TREE **************************

// Set the dimensions and margins of the tree
var margin = {top: 0, right: 0, bottom: 0, left: 0},
    treeWidth = 1100 - margin.left - margin.right,
    treeHeight = 600 - margin.top - margin.bottom;

// Create Zoom
var zoom = d3.zoom()
    .scaleExtent([.5, 3])
    .on("zoom", zoomed);

// Create container to call zoom on
var svgContainer = d3.select("#large-tree").append("svg")
    .attr("width", treeWidth + margin.right + margin.left)
    .attr("height", treeHeight + margin.top + margin.bottom)
    .call(zoom);

// Create container for tree
var svgTree = svgContainer.append("g");

// Set initial zoom and transform
svgContainer.call(zoom.transform, d3.zoomIdentity.translate(50,25).scale(.5));

// Set some variables
var i = 0,
    duration = 500,
    root;

var fillbase = "#B3DCB0";
var fillhover = "#89C984";
var linkcolor = "#14530F";
var strokecolor = "#14530F";
var normXsize = 160;
var normXpos = -70;
var growXsize = 166;
var growXpos = -72;
var normYsize = 32;
var normYpos = -16;
var growYsize = 38;
var growYpos = -20;

// Declare a tree layout
var tree = d3.tree().size([treeWidth, treeHeight]);

// Set node seperation
tree.separation(function(a, b) { return a.parent === b.parent ? 1 : 1; });

// Assign parent, children, height, depth
root = d3.hierarchy(treeData, function(d) { return d.children; });
root.x0 = treeWidth / 2;
root.y0 = 0;

// Assign the x and y position for the nodes
var treePosition = tree(root);

// Compute the new tree layout
var nodes = treePosition.descendants(),
    links = treePosition.descendants().slice(1);

// Normalize for fixed-depth
nodes.forEach(function(d){ d.y = d.depth * 185});

// ****************** Create Tooltip **************************

var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<p>" + d.data.name + "</p>"
         + "<p><em>Born: " + d.data.birth + "</em></p>"
         + "<p><em>Location: </em>" + d.data.location + "</p>";
  });

  svgTree.call(tip);

// ****************** Reset Button ****************************

d3.select('#reset-button')
  .on("click", reset);

// ****************** Nodes section ***************************

// Create nodes
var node = svgTree.selectAll('g.node')
              .data(nodes)
              .enter().append('g')
              .attr('class', 'node')
              .attr('transform', function(d) { return 'translate(' + d.y + "," + d.x + ')'; });


// Add rectangles to nodes
node.append('rect')
      .attr('class', 'node')
      .attr('x', normXpos)
      .attr('y', normYpos)
      .attr('width', normXsize)
      .attr('height', normYsize)
      .style('fill', fillbase)
      .on('mouseover', tip.show)
      .on('mouseout',  tip.hide)
      .on('mouseenter', enterThis)
      .on('mouseleave', leaveThis)
      .on('click', clickThis)
;

// Add names to nodes
node.append('text')
      .attr('x', -66)
      .attr('y', 6)
      .text(function(d) { return d.data.name; })
      .style('pointer-events', 'none');

// ************** Mouse Events for Nodes *********************

// mouseenter events
function enterThis(p) {

  //Grow node
    d3.select(this)
      .attr("x", growXpos)
      .attr("y", growYpos)
      .attr("width", growXsize)
      .attr("height", growYsize);

  //select node parents
    var nodes = [];
	  nodes.push(p);
	  while(p.parent) {
		  p = p.parent;
		  nodes.push(p);
    }

   //color the node parents
    node.filter(function(d) { if ( nodes.indexOf(d) !== -1) return true;} )
       .select('rect')
       .style("fill", fillhover);
}

// mouseleave events
function leaveThis(p) {

// Return node to normal size and remove styles
  if (d3.select(this).classed("isclicked") === false) {
     d3.select(this)
       .attr("x",normXpos)
       .attr("y", normYpos)
       .attr("width", normXsize)
       .attr("height", normYsize)
       .style("fill", fillbase);
  }

 //select node parents
   var nodes = [];
	   nodes.push(p);
	     while(p.parent) {
		   p = p.parent;
		   nodes.push(p);
	   }

  //revert color of nodes
   node.filter(function(d) { if ( nodes.indexOf(d) !== -1) return true;} )
       .select('rect')
       .style("fill", fillbase);

}

// on click events
function clickThis(d) {

// when a different node is clicked
  d3.selectAll('rect.node')
       .attr("x", normXpos)
       .attr("y", normYpos)
       .attr("width", normXsize)
       .attr("height", normYsize)
       .style('stroke', "none")
       .call(tip.hide)
       .classed("isclicked", false);

// when THIS node is clicked
    d3.select(this)
       .attr("x", growXpos)
       .attr("y", growYpos)
       .attr("width", growXsize)
       .attr("height", growYsize)
       .style('stroke', strokecolor)
       .style('stroke-width', "2px")
       .classed("isclicked", d3.select(this).classed("isclicked") ? false : true);

 // zoom and center on clicked node
    svgContainer.transition()
        .duration(750)
        .call(zoom.transform,
              d3.zoomIdentity
                .translate(treeWidth / 2, treeHeight / 2)
                .scale(1)
                .translate(-d.y, -d.x)
        );

function parentList(d) {
    if (d.children === undefined) {
    return "Unknown Parents";
  } else if (d.children[1] === undefined) {
    return d.children[0].data.name + " and Unknown Parent";
  } else {
    return d.children[0].data.name + " and " + d.children[1].data.name;
  }
}

function directDesc(d) {
  if (d.parent === null) {
    return "Private";
  } else {
    return d.parent.data.name;
  }
}

  // display node information in legend
    d3.select('#clickinfo')
       .html('<div class="legend-name">'
             + '<h3>' + d.data.fullname + '</h3>'
             + "<p><strong>Born:</strong> <em>" + d.data.birth + "</em></p>"
             + "<p><strong>Location:</strong> " + d.data.location + "</p>"
             + "<p><strong>Parents:</strong> " + parentList(d)  + "</p>"
             + "<p><strong>Direct Descendant:</strong> " + directDesc(d) + "</p>"
             + "<p><strong><a href='https://krogersst.github.io/landgren-collins" + d.data.link
             + "'>More Info <i class='fas fa-share-square'></i></a></strong></p>");

}

// ****************** links section ***************************

// Create link paths
function diagonal(d) {
  return "M" + d.y + "," + d.x
       + "V" + d.parent.x
       + "H" + d.parent.y;
}

// Create links
var link = svgTree.selectAll('path.link')
      .data(links, function(d) { return d.id; })
      .enter().insert('path', "g")
      .attr("class", "link")
      .style("stroke", linkcolor)
      .style("stroke-width", "2px")
      .style("fill", "none")
      .attr("d", diagonal);

//****************** Reset Function *******************************

  function reset() {

 // return zoom scale
   svgContainer.transition()
      .duration(750)
      .call(zoom.transform,
        d3.zoomIdentity
        .translate(50, 25)
        .scale(.5)
      );

 // remove node stylings
    d3.selectAll('.node')
       .attr("x", normXpos)
       .attr("y", normYpos)
       .attr("width", normXsize)
       .attr("height", normYsize)
       .style("stroke", "none");

 // clear legend information
    d3.select('#clickinfo').html("");

  }

// ************************ Zoomed Function *****************************
  function zoomed() {
      svgTree.attr("transform", d3.event.transform);
  }
